dojo.declare("geoweb2book.PrintableLayer",esri.layers.DynamicMapServiceLayer,{constructor:function(a,b){this.layers=b.layers,this.initialExtent=this.fullExtent=b.extent,this.spatialReference=this.initialExtent.spatialReference,this.loaded=!0,this.onLoad(this)},getImageUrl:function(a,b,c,d){var f,e,g;try{e=[],dojo.forEach(this.layers,function(a){if(a.visible){if(f={url:a.url,format:0==e.length?"jpg":"png",opacity:a.opacity},a.layers&&(f.layers="show:"+a.layers.join(",")),a.layerDefs){var b=[];dojo.forEach(a.layerDefs,function(a,c){a&&b.push(c+":"+a)}),f.layerDefs=b.join(";")}e.push(dojo.toJson(f))}}),g={width:b,height:c,extent:dojo.toJson(a.toJson()),layers:e},esri.request({url:this.url,content:g,handleAs:"json",load:function(a){d(a.href)},error:this.onError})}catch(i){this.onError(i)}}});