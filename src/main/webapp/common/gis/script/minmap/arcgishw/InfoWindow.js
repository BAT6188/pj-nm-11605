define(["dojo/Evented","dojo/parser","dojo/on","dojo/_base/declare","dojo/dom-construct","dojo/_base/array","dojo/dom-style","dojo/_base/lang","dojo/dom-class","dojo/fx","dojo/Deferred","esri/domUtils","esri/InfoWindowBase"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n,o,p,q,r,t,s=null;return d([m,a],{constructor:function(a){var b=this;t=a.options,h.mixin(this,a),i.add(this.domNode,"customInfoWindow"),this._closeButton=e.create("div",{"class":"close",title:"关闭"},this.domNode),this._title=e.create("div",{"class":"title"},this.domNode),this._content=e.create("div",{"class":"content"},this.domNode),this._arrow=e.create("div",{"class":"arrow"},this.domNode),c(this._closeButton,"click",h.hitch(this,function(){b.hide()})),l.hide(this.domNode),this.isShowing=!1},setMap:function(a){this.inherited(arguments),a.on("pan",h.hitch(this,function(a){var b=a.delta;this.isShowing&&null!=s&&this._showInfoWindow(s.x+b.x,s.y+b.y)})),a.on("pan-end",h.hitch(this,function(a){var b=a.delta;this.isShowing&&(s.x=s.x+b.x,s.y=s.y+b.y)})),a.on("zoom-start",h.hitch(this,function(){l.hide(this.domNode),this.onHide()})),a.on("zoom-end",h.hitch(this,function(){this.isShowing&&(s=this.map.toScreen(r),this._showInfoWindow(s.x,s.y))}))},setTitle:function(a){this.place(a,this._title)},setContent:function(a){this.place(a,this._content)},_showInfoWindow:function(a,b){var c=n/2,d=o;t&&t.getXOffset&&(c=t.getXOffset(n,o)),t&&t.getYOffset&&(d=t.getYOffset(n,o)),g.set(this.domNode,{left:a-c+"px",top:b-d+"px"}),l.show(this.domNode)},show:function(a){var b,c;r=a,p=this.map.extent.getCenter(),q=this.map.toScreen(p),a.spatialReference&&(a=this.map.toScreen(a)),b=a.x-n/2,c=a.y-o,s=a,5>c&&(q.y=q.y+c-5),5>b&&(q.x=q.x+b-5),this._showInfoWindow(s.x,s.y),p=this.map.toMap(q),this.map.centerAt(p),this.isShowing=!0,this.onShow()},hide:function(){l.hide(this.domNode),this.isShowing=!1,this.onHide()},resize:function(a,b){var c=20,d=30;t&&t.titleHeight&&(c=t.titleHeight),t&&t.arrowHeight&&(d=t.arrowHeight),n=a,o=b+c+d,g.set(this._content,{width:a+"px",height:b+"px"}),g.set(this._title,{height:c+"px"})},destroy:function(){e.destroy(this.domNode),this._closeButton=this._title=this._content=null}})});